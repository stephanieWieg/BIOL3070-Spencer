---
title: "Warm-up mini-Report: Mosquito Blood Hosts in \n Salt Lake City, Utah"
author: "Stephanie Spencer"
date: "`r Sys.Date()`"
output:
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# ABSTRACT 
This study focuses on the connection between House finches and WNV cases in Salt Lake City, UT. We wanted to know if there was a correlation between the observed higher blood meal counts of house finch and their presence in WNV positive areas. This was done by collecting samples of mosquitoes in the SLC area. Their blood meal DNA and therefore were identified by PCR of the blood meal, and BLASTn analysis of the results. These counts showed house finch as the highest in count in both areas, but even higher in the location with WNV positive cases. Through a GLM analysis this was shown to be a positive correlation, as house finch presence increases, so does the probability of WNV cases.  

# BACKGROUND 
Westnile virus is transmitted from birds to other species and humans by mosquitoes. In order to track the species that mosquitoes visit for their blood meals we can collect them and use PCR to extract tags that allow us to identify the animals. This will allow us to understand which species are experiencing viremia and are living close to humans where they can receive the virus from them. In a study by Komar et al. (2003), they were able to determine which species viremia has a longer duration in, therefore providing a larger window for it to be transmitted to other organisms by mosquitoes. They found similar duration for many birds (around 4 days).For a few birds, like house finch, there was a longer duration of up to 6-7 days. House finch is a very common bird throughout the United States and does minimal migration, living in a diverse range of habitats. They are most often found around humans in places with trees, lawns and buildings (National Audubon Society, 2025). This connection between viremia cases, and the closeness of house finches to humans with their long duration of detectable viremia is yet to be explored. 

```{r viremia, include=TRUE, eval=TRUE, warning=FALSE, fig.align='left', fig.width=4.75, fig.height=7}
# Manually transcribe duration (mean, lo, hi) from the last table column
duration <- data.frame(
  Bird = c("Canada Goose","Mallard", 
           "American Kestrel","Northern Bobwhite",
           "Japanese Quail","Ring-necked Pheasant",
           "American Coot","Killdeer",
           "Ring-billed Gull","Mourning Dove",
           "Rock Dove","Monk Parakeet",
           "Budgerigar","Great Horned Owl",
           "Northern Flicker","Blue Jay",
           "Black-billed Magpie","American Crow",
           "Fish Crow","American Robin",
           "European Starling","Red-winged Blackbird",
           "Common Grackle","House Finch","House Sparrow"),
  mean = c(4.0,4.0,4.5,4.0,1.3,3.7,4.0,4.5,5.5,3.7,3.2,2.7,1.7,6.0,4.0,
           4.0,5.0,3.8,5.0,4.5,3.2,3.0,3.3,6.0,4.5),
  lo   = c(3,4,4,3,0,3,4,4,4,3,3,1,0,6,3,
           3,5,3,4,4,3,3,3,5,2),
  hi   = c(5,4,5,5,4,4,4,5,7,4,4,4,4,6,5,
           5,5,5,7,5,4,3,4,7,6)
)

# Choose some colors
cols <- c(rainbow(30)[c(10:29,1:5)])  # rainbow colors

# horizontal barplot
par(mar=c(5,12,2,2))  # wider left margin for names
bp <- barplot(duration$mean, horiz=TRUE, names.arg=duration$Bird,
              las=1, col=cols, xlab="Days of detectable viremia", xlim=c(0,7))

# add error bars
arrows(duration$lo, bp, duration$hi, bp,
       angle=90, code=3, length=0.05, col="black", xpd=TRUE)
```

# STUDY QUESTION and HYPOTHESIS

## Questions 
Which species are in most abundance of the mosquitoes for taking blood meals from in areas that are experiencing known WNV cases? 

## Hypothesis 
House finch DNA will be found in higher concentration of the collected blood meals in areas where viremia is present.
  
## Prediction 
If house finches are a main host for viremia disease then we will see a larger portion of blood meals from house finches in the areas that have WNV in humans.

# METHODS 
Part 1: PCR
Mosquitoes were collected in areas near Salt Lake City Utah over 3 years. These frozen mosquitoes mashed and prepared for PCR analysis of their blood meals. This included adding the necessary polymers for PCR. 

Part 2: Graphs and Analysis
The results from PCR allowed us to get counts of the types of organisms the mosquitoes were feeding on from the BLASTn database. This data was put into graphs based on the source location where the moquitoes were collected. Either an area with active viremia cases or an area without viremia cases. Using these two groups we could conduct a glm analysis to give us a likelyhood if the factor of a species and their presence in a viremia or non viremia area was statistcally significant. 

## Bar plots of Detected Species 
These bar plots show both comparison between species as well as comparison between sites in Salt Lake where there are WNV-positive pools or without WNV-positive pools. The bar plot allows us to visually quantify which values stand out easily and make comparisons by location.

```{r first-analysis, warning=FALSE}
## import counts_matrix: data.frame with column 'loc_positives' (0/1) and host columns 'host_*'
counts_matrix <- read.csv("./bloodmeal_plusWNV_for_BIOL3070.csv")

## 1) Identify host columns
host_cols <- grep("^host_", names(counts_matrix), value = TRUE)

if (length(host_cols) == 0) {
  stop("No columns matching '^host_' were found in counts_matrix.")
}

## 2) Ensure loc_positives is present and has both levels 0 and 1 where possible
counts_matrix$loc_positives <- factor(counts_matrix$loc_positives, levels = c(0, 1))

## 3) Aggregate host counts by loc_positives
agg <- stats::aggregate(
  counts_matrix[, host_cols, drop = FALSE],
  by = list(loc_positives = counts_matrix$loc_positives),
  FUN = function(x) sum(as.numeric(x), na.rm = TRUE)
)

## make sure both rows exist; if one is missing, add a zero row
need_levels <- setdiff(levels(counts_matrix$loc_positives), as.character(agg$loc_positives))
if (length(need_levels)) {
  zero_row <- as.list(rep(0, length(host_cols)))
  names(zero_row) <- host_cols
  for (lv in need_levels) {
    agg <- rbind(agg, c(lv, zero_row))
  }
  ## restore proper type
  agg$loc_positives <- factor(agg$loc_positives, levels = c("0","1"))
  ## coerce numeric host cols (they may have become character after rbind)
  for (hc in host_cols) agg[[hc]] <- as.numeric(agg[[hc]])
  agg <- agg[order(agg$loc_positives), , drop = FALSE]
}

## 4) Decide species order (overall abundance, descending)
overall <- colSums(agg[, host_cols, drop = FALSE], na.rm = TRUE)
host_order <- names(sort(overall, decreasing = TRUE))
species_labels <- rev(sub("^host_", "", host_order))  # nicer labels

## 5) Build count vectors for each panel in the SAME order
counts0 <- rev(as.numeric(agg[agg$loc_positives == 0, host_order, drop = TRUE]))
counts1 <- rev(as.numeric(agg[agg$loc_positives == 1, host_order, drop = TRUE]))

## 6) Colors: reuse your existing 'cols' if it exists and is long enough; otherwise generate
if (exists("cols") && length(cols) >= length(host_order)) {
  species_colors <- setNames(cols[seq_along(host_order)], species_labels)
} else {
  species_colors <- setNames(rainbow(length(host_order) + 10)[seq_along(host_order)], species_labels)
}

## 7) Shared x-limit for comparability
xmax <- max(c(counts0, counts1), na.rm = TRUE)
xmax <- if (is.finite(xmax)) xmax else 1
xlim_use <- c(0, xmax * 1.08)

## 8) Plot: two horizontal barplots with identical order and colors
op <- par(mfrow = c(1, 2),
          mar = c(4, 12, 3, 2),  # big left margin for species names
          xaxs = "i")           # a bit tighter axis padding

## Panel A: No WNV detected (loc_positives = 0)
barplot(height = counts0,
        names.arg = species_labels, 
        cex.names = .5,
        cex.axis = .5,
        col = rev(unname(species_colors[species_labels])),
        horiz = TRUE,
        las = 1,
        xlab = "Bloodmeal counts",
        main = "Locations WNV (-)",
        xlim = xlim_use)

## Panel B: WNV detected (loc_positives = 1)
barplot(height = counts1,
        names.arg = species_labels, 
        cex.names = .5,
        cex.axis = .5,
        col = rev(unname(species_colors[species_labels])),
        horiz = TRUE,
        las = 1,
        xlab = "Bloodmeal counts",
        main = "Locations WNV (+)",
        xlim = xlim_use)

par(op)

## Keep the colors mapping for reuse elsewhere
host_species_colors <- species_colors
```
## Generalized Linear Model 
The generalized linear model allows us to compare the probability that house finch is correlated with WNV incidents. This comparison is quanified by giving us a slope of that correlation as well as a p value, which can be used to help determine if the probability suggested by the bar plots is statistically significant. 

```{r}
# second-analysis-or-plot, glm with house finch alone against binary +/_
glm1 <- glm(loc_positives ~ host_House_finch,
            data = counts_matrix,
            family = binomial)
summary(glm1)

#glm with house-finch alone against positivity rate
glm2 <- glm(loc_rate ~ host_House_finch,
            data = counts_matrix)
summary(glm2)
```


# DISCUSSION 
The bar plots shows that house finch is the most common blood meal for the mosquitoes that were sampled. But, an even higher count was found in the locations where WNV is present. This could mean there is a connection between house finch presence and higher WNV case counts. This supports the hypothesis.

The Generalized linear model allows us to quantify this correlation with numbers. This number shows the probability that this correlation is due to chance. The p value is less that 0.001, which is considered statistically significant. This means there is very likely a correlation between house finch presence and WNV cases. This supports the hypothesis. 

These data could lead in another direction of how to manage WNV cases by treating maybe this house finch population with something that helps them build an immunity or decrease th duration time of the virus in them to slow transmission. Another option would be to limit their habitat to places a bit further from such dense populations of humans and building a suitable environment for them in more remote locations. These actions could indirectly affect how many WNV cases we see in humans by decreasing the pool which is getting infected. 

## Interpretation of barplots 
The bar plots showed not only that in both areas we see higher numbers of house finches compared to other species, but also that in the areas with positive WVN there was an even greater number of house finch DNA as blood meals. We saw little variation with other species as many were one or two instances. 

## Interpretation of generalized linear model 
The generalized linear model gives us useful information that helps us determine how statistically significant the comparison of house finch frequency compared to other birds. The given p value was less that 0.001, which was very significant. This shows that it was very likely that the blood meal counts were not by chance, and there may be an unknown cause for this correlation. The slope is also found to be positive between these two variables, meaning as house finch blood meal counts increases, WNV positive counts increases. 

# CONCLUSION 

To answer the question "Which species are in most abundance of the mosquitoes for taking blood meals from in areas that are experiencing known WNV cases?" we have several pieces of data. We see a trend of House finches being the most common for blood meals for both locations with and without WNV. However, the correlation of house finches in the location with WNV cases had a p value of less than 0.001 according to a glm analysis. This shows that there is a correlation between House finch and WNV cases. This allows us to accept our hypothesis and reject a null hypothesis. WNV may be amplified more in areas where House finch, a long duration carrier of WNV, is found in habitats in close proximity to humans.  

# REFERENCES    
1. Komar N, Langevin S, Hinten S, Nemeth N, Edwards E, Hettler D, Davis B, Bowen R, Bunning M. Experimental infection of North American birds with the New York 1999 strain of West Nile virus. Emerg Infect Dis. 2003 Mar;9(3):311-22. https://doi.org/10.3201/eid0903.020628

2. ChatGPT. OpenAI, version Jan 2025. Used as a reference for functions such as plot() and to correct syntax errors. Accessed `r Sys.Date()`.

3. National Audubon Society. (2025). House Finch. Audubon. https://www.audubon.org/field-guide/bird/house-finch


